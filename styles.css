:root { --bg:#0b1212; --card:#0f1a1a; --text:#e6f2f2; --muted:#9db3b3; --accent:#0d9488; --ok:#16a34a; --warn:#efb417; --hot:#ef4444; }
@media (prefers-color-scheme: light) {
  :root { --bg:#f6fbfb; --card:#ffffff; --text:#0a2a2a; --muted:#5c7070; --accent:#0d9488; --ok:#15803d; --warn:#a16207; --hot:#b91c1c; }
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,"PingFang TC","Noto Sans TC",sans-serif}
a{color:var(--accent);text-decoration:none}
.app-bar{position:sticky;top:0;background:var(--card);padding:12px 16px;border-bottom:1px solid #0c2222;display:flex;gap:8px;align-items:center;justify-content:space-between}
h1{margin:0;font-size:18px}
.container{max-width:900px;margin:0 auto;padding:12px 16px 80px}
.toolbar .row{display:flex;gap:8px;align-items:center;margin:8px 0}
.toolbar .gap{gap:12px}
input[type="search"]{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #1e3a3a;background:var(--card);color:var(--text)}
.btn{padding:10px 12px;border-radius:10px;border:1px solid #1e3a3a;background:var(--card);color:var(--text);cursor:pointer}
.btn.small{padding:6px 10px;font-size:13px}
.meta{color:var(--muted);font-size:13px}
.meta .dot{padding:0 6px}
.chip{display:inline-flex;gap:8px;align-items:center;background:var(--card);border:1px solid #1e3a3a;border-radius:999px;padding:6px 10px;color:var(--text);font-size:14px}
.alert{margin-top:8px;background:#2a1a00;border:1px solid #4b2e00;color:#ffd89a;padding:10px 12px;border-radius:10px}
.list{display:grid;gap:10px;margin-top:12px}
.card{display:flex;justify-content:space-between;gap:12px;padding:14px;border-radius:12px;background:var(--card);border:1px solid #163232}
.card .left{min-width:0}
.card h3{margin:0 0 4px;font-size:17px}
.card .addr{margin:0;color:var(--muted);font-size:13px}
.card .sub{margin:6px 0 0;color:var(--muted);font-size:13px}
.card .right{display:flex;flex-direction:column;align-items:flex-end;justify-content:center;gap:6px;white-space:nowrap}
.status-badge,.eta-badge{padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid #1e3a3a}
.status-badge.ok{background:rgba(22,163,74,.16);border-color:rgba(22,163,74,.4)}
.status-badge.warn{background:rgba(239,180,23,.16);border-color:rgba(239,180,23,.4)}
.status-badge.hot{background:rgba(239,68,68,.16);border-color:rgba(239,68,68,.4)}
.status-badge.dim{opacity:.7}
.plate{font-variant-numeric:tabular-nums}
.time{font-variant-numeric:tabular-nums;color:var(--muted)}
.sep{opacity:.5;margin:0 6px}
.alert-line{margin:6px 0 0;color:#ffd89a;font-size:12px;line-height:1.3}
.footer{position:sticky;bottom:0;background:linear-gradient(180deg, transparent, var(--bg) 40%);padding:24px 16px 28px;text-align:center;color:var(--muted);font-size:12px}
@media (hover:hover){.card:hover{border-color:#1f4242}}
:root { --bg:#0b1212; --card:#0f1a1a; --text:#e6f2f2; --muted:#9db3b3; --accent:#0d9488; --ok:#16a34a; --warn:#efb417; --hot:#ef4444; }
@media (prefers-color-scheme: light) {
:root { --bg:#f6fbfb; --card:#ffffff; --text:#0a2a2a; --muted:#5c7070; --accent:#0d9488; --ok:#15803d; --warn:#a16207; --hot:#b91c1c; }
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);font:16px/1.4 system-ui,-apple-system,"Segoe UI",Roboto,"PingFang TC","Noto Sans TC",sans-serif}
.app-bar{position:sticky;top:0;background:var(--card);padding:12px 16px;border-bottom:1px solid #0c2222;display:flex;gap:8px;align-items:center;justify-content:space-between}
.container{max-width:900px;margin:0 auto;padding:12px 16px 80px}
.toolbar .row{display:flex;gap:8px;align-items:center;margin:8px 0}
.toolbar .gap{gap:12px}
input[type="search"]{flex:1;padding:10px 12px;border-radius:10px;border:1px solid #1e3a3a;background:var(--card);color:var(--text)}
select#routeSelect{min-width:160px;padding:10px 12px;border-radius:10px;border:1px solid #1e3a3a;background:var(--card);color:var(--text)}
.btn{padding:10px 12px;border-radius:10px;border:1px solid #1e3a3a;background:var(--card);color:var(--text);cursor:pointer}
.btn.small{padding:6px 10px;font-size:13px}
.meta{color:var(--muted);font-size:13px}
.meta .dot{padding:0 6px}
.chip{display:inline-flex;gap:8px;align-items:center;background:var(--card);border:1px solid #1e3a3a;border-radius:999px;padding:6px 10px;color:var(--text);font-size:14px}
.alert{margin-top:8px;background:#2a1a00;border:1px solid #4b2e00;color:#ffd89a;padding:10px 12px;border-radius:10px}
.footer{position:sticky;bottom:0;background:linear-gradient(180deg, transparent, var(--bg) 40%);padding:24px 16px 28px;text-align:center;color:var(--muted);font-size:12px}


/* timeline */
.timeline{display:flex;flex-direction:column;gap:10px;margin-top:12px}
.station-row{display:grid;grid-template-columns:72px 28px 1fr;gap:8px;align-items:start;padding:10px;border-radius:10px;background:transparent}
.station-row + .station-row{border-top:1px dashed rgba(255,255,255,0.03)}
.time-col{display:flex;flex-direction:column;align-items:flex-end;font-size:14px;color:var(--muted)}
.time-col .time{font-variant-numeric:tabular-nums}
.delay{font-size:12px;margin-top:6px}
.line-col{display:flex;flex-direction:column;align-items:center;position:relative}
.line-col .dot{width:14px;height:14px;border-radius:50%;background:rgba(157,179,179,0.14);border:2px solid rgba(157,179,179,0.22);z-index:2}
.line-col .line{flex:1;width:2px;background:rgba(157,179,179,0.06);margin-top:6px}
.name-col{font-size:16px;padding-left:6px}
.name-col .addr{margin-top:6px}
.station-row.active .dot{background:var(--accent);border-color:rgba(13,148,136,0.9);box-shadow:0 0 8px rgba(13,148,136,0.12)}
.station-row.active .stop-name{color:var(--accent);font-weight:600}
.station-row.upcoming .dot{background:var(--ok);border-color:rgba(22,163,74,0.9)}
.station-row.delayed .delay{color:var(--hot)}
@media (hover:hover){.station-row:hover{background:rgba(255,255,255,0.02)}}

/* ===== timeline：對齊修正、隱藏 per-stop addr、highlight 段 ===== */
:root{
  --time-col-width:72px;    /* 與 .station-row grid-template-columns 第一欄一致 */
  --line-col-width:28px;    /* 與 第二欄一致 */
  --grid-gap:18px;           /* 與 .station-row 的 gap 值一致 */
  --timeline-line-color: rgba(157,179,179,0.06);
  --timeline-line-width: 2px;
  --timeline-line-offset-top: 12px;
  --timeline-line-offset-bottom: 12px;
}

/* timeline 容器定位 */
.timeline { position: relative; }

/* 背景淺色全局線，考慮 gap/欄位對齊 */
.timeline::before{
  content: "";
  position: absolute;
  left: calc(
    var(--time-col-width)
    + var(--grid-gap)
    + (var(--line-col-width) / 2)
    - (var(--timeline-line-width) / 2)
  );
  top: var(--timeline-line-offset-top);
  bottom: var(--timeline-line-offset-bottom);
  width: var(--timeline-line-width);
  background: var(--timeline-line-color);
  z-index: 1;
  border-radius: 2px;
}

/* 隱藏原本每列的 .line（避免和全局線重複） */
.line-col .line { display: none; }

/* dot 置頂層 */
.line-col .dot { position: relative; z-index: 5; }

/* per-row highlight 段（由 JS 建立 .highlight-seg 元素） */
.highlight-seg {
  position: absolute;
  width: var(--timeline-line-width);
  background: var(--accent);
  z-index: 3; /* 在底線上方但在 dot 下方（dot z-index = 5） */
  border-radius: 2px;
  transition: height .18s ease, top .18s ease, opacity .18s ease;
  opacity: 0.98;
}

/* active / upcoming / delayed dot 樣式保留 */
.station-row .dot { transition: transform .12s ease, box-shadow .12s ease; }
.station-row.active .dot {
  transform: scale(1.08);
  background: var(--accent);
  border-color: rgba(13,148,136,0.95);
  box-shadow: 0 0 8px rgba(13,148,136,0.12);
  z-index: 6;
}
.station-row.upcoming .dot { z-index: 5; }
.station-row.delayed .dot { z-index: 5; }

/* 右側站名下方的地址全部隱藏（user 要求） */
.name-col .addr { display: none !important; }

/* 微調：若要看起來更順滑可保留 hover 動畫 */
@media (hover:hover) {
  .station-row:hover .dot { transform: translateY(-2px) scale(1.03); }
}

/* ===== dot 不透明且置於線上方，並依狀態著色 ===== */
.line-col .dot {
  width: 14px;
  height: 14px;
  border-radius: 50%;
  /* 預設不透明顏色（muted）*/
  background: var(--muted);
  border: 2px solid rgba(157,179,179,0.18);
  z-index: 6; /* 確保在線與高亮之上 */
  box-shadow: none;
  transition: transform .12s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
}

/* 狀態顏色對照（依據 statusClass 輸出的 class）*/
/* 緊急/即將到站（active）：使用 --hot（紅）表示即刻注意）*/
.station-row.active .dot {
  background: var(--hot);
  border-color: rgba(239,68,68,0.95);
  box-shadow: 0 0 8px rgba(239,68,68,0.14);
  transform: scale(1.08);
}

/* 即將到站（upcoming，約 2-3 分）：使用 --warn（黃橙）*/
.station-row.upcoming .dot {
  background: var(--warn);
  border-color: rgba(239,180,23,0.95);
  box-shadow: 0 0 6px rgba(239,180,23,0.10);
}

/* 慢到／延誤（delayed，大於 3 分）：使用 --ok（綠）*/
.station-row.delayed .dot {
  background: var(--ok);
  border-color: rgba(21,128,61,0.9);
  box-shadow: 0 0 6px rgba(21,128,61,0.10);
}

/* 其他或無資訊（dim）：使用淡色 */
.station-row.dim .dot {
  background: var(--muted);
  border-color: rgba(157,179,179,0.18);
  box-shadow: none;
}

/* dot hover 動畫（桌面） */
@media (hover:hover) {
  .station-row:hover .dot { transform: translateY(-2px) scale(1.03); }
}

/* highlight 段（保留樣式，顏色會由 JS 設定以配合來源 dot 顏色） */
.highlight-seg {
  position: absolute;
  width: var(--timeline-line-width);
  z-index: 3; /* 在底線上方但在 dot 下方 */
  border-radius: 2px;
  transition: height .18s ease, top .18s ease, opacity .18s ease, background .18s ease;
  opacity: 0.98;
}
